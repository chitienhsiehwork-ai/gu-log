---
interface Props {
  currentLang: 'zh-tw' | 'en';
  currentPath: string;
}

const { currentLang, currentPath } = Astro.props;

// Calculate the alternate language path
const getAlternatePath = () => {
  if (currentLang === 'zh-tw') {
    // zh-tw -> en: add /en prefix AND add en- to post slug
    // e.g., /posts/foo -> /en/posts/en-foo
    const match = currentPath.match(/^\/posts\/(.+)/);
    if (match) {
      return `/en/posts/en-${match[1]}`;
    }
    return `/en${currentPath}`;
  } else {
    // en -> zh-tw: remove /en prefix AND remove en- from post slug
    // e.g., /en/posts/en-foo -> /posts/foo
    const withoutEnPrefix = currentPath.replace(/^\/en/, '') || '/';
    const match = withoutEnPrefix.match(/^\/posts\/en-(.+)/);
    if (match) {
      return `/posts/${match[1]}`;
    }
    return withoutEnPrefix;
  }
};

const alternatePath = getAlternatePath();
const alternateLabel = currentLang === 'zh-tw' ? 'En' : '文';
---

<a
  href={alternatePath}
  class="lang-toggle"
  title={currentLang === 'zh-tw' ? 'Switch to English' : '切換至中文'}
>
  <svg class="lang-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M2 12h20"></path>
    <path
      d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
    ></path>
  </svg>
  <span>{alternateLabel}</span>
</a>

<style>
  .lang-toggle {
    display: flex;
    align-items: center;
    gap: 0.1rem;
    padding: 0.15rem 0.25rem;
    border-radius: 4px;
    color: var(--color-text-muted);
    text-decoration: none;
    font-size: 0.7rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .lang-toggle:hover {
    color: var(--color-accent);
    background: var(--color-surface);
  }

  .lang-icon {
    width: 12px;
    height: 12px;
  }
</style>
