---
// ClawdNote component for Clawd's commentary
// Automatically adds a fun, varied prefix to make it clear this is Clawd speaking
//
// Variants:
//   "note" (default) â€” technical supplement / commentary (existing behavior)
//   "murmur" â€” casual ç¢ç¢å¿µ / inner monologue style

interface Props {
  /** Optional custom prefix. If not provided, one is selected based on content */
  prefix?: string;
  /** Visual variant: "note" (default) | "murmur" (casual ç¢ç¢å¿µ) */
  variant?: 'note' | 'murmur';
}

const { prefix, variant = 'note' } = Astro.props;

// Fun prefixes that give Clawd personality - é„‰æ°‘/æå®æ¯… style
const notePrefixes = [
  'Clawd ç¢ç¢å¿µï¼š',
  'Clawd å¿ä¸ä½èªªï¼š',
  'Clawd æƒ³è£œå……ï¼š',
  'Clawd OSï¼š',
  'Clawd å…§å¿ƒæˆ²ï¼š',
  'Clawd æ­ªæ¨“ä¸€ä¸‹ï¼š',
  'Clawd murmurï¼š',
  'Clawd æ’å˜´ï¼š',
  'Clawd æº«é¦¨æç¤ºï¼š',
  'Clawd çœŸå¿ƒè©±ï¼š',
  'Clawd åæ§½æ™‚é–“ï¼š',
  'Clawd èªçœŸèªªï¼š',
  'Clawd è£œå€‹åˆ€ï¼š',
  'Clawd å·å·èªªï¼š',
  'Clawd ç•«é‡é»ï¼š',
];

const murmurPrefixes = [
  'ğŸ„ Clawd ç¢ç¢å¿µï¼š',
  'ğŸ„ Clawd å·å·è¬›ï¼š',
  'ğŸ„ Clawd å…§å¿ƒå°åŠ‡å ´ï¼š',
  'ğŸ„ Clawd çš„ murmurï¼š',
  'ğŸ„ Clawd å˜€å’•ä¸€ä¸‹ï¼š',
];

const prefixes = variant === 'murmur' ? murmurPrefixes : notePrefixes;

// Get the slot content for hashing
const slotContent = await Astro.slots.render('default');

// Simple hash function based on content
function hashString(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = (hash << 5) - hash + char;
    hash = hash & hash; // Convert to 32bit integer
  }
  return Math.abs(hash);
}

// Select prefix based on content hash (deterministic but varied)
const contentHash = hashString(slotContent);
const selectedPrefix = prefix || prefixes[contentHash % prefixes.length];
const isNote = variant === 'note';
---

<blockquote class:list={['claude-note', { 'claude-note--murmur': !isNote }]}>
  <strong class="clawd-prefix">{selectedPrefix}</strong>
  <br />
  <Fragment set:html={slotContent} />
</blockquote>

<style>
  .clawd-prefix {
    color: #cb7551;
    font-size: 0.95em;
    display: block;
    margin-bottom: 0.3rem;
  }

  /* Murmur variant styling */
  .claude-note--murmur {
    border-left-color: #9d7cd8 !important;
    background: rgba(157, 124, 216, 0.06) !important;
    font-style: italic;
    border-radius: 0 12px 12px 0 !important;
    padding: 1rem 1.25rem !important;
  }

  .claude-note--murmur .clawd-prefix {
    color: #9d7cd8;
  }

  /* Light theme murmur */
  [data-theme='light'] .claude-note--murmur {
    border-left-color: #6c71c4 !important;
    background: rgba(108, 113, 196, 0.06) !important;
  }

  [data-theme='light'] .claude-note--murmur .clawd-prefix {
    color: #6c71c4;
  }
</style>
