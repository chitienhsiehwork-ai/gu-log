---
// ClawdNote component for Clawd's commentary
// Automatically adds a fun, varied prefix to make it clear this is Clawd speaking
//
// Variants:
//   "note" (default) — technical supplement / commentary (existing behavior)
//   "murmur" — casual 碎碎念 / inner monologue style

interface Props {
  /** Optional custom prefix. If not provided, one is selected based on content */
  prefix?: string;
  /** Visual variant: "note" (default) | "murmur" (casual 碎碎念) */
  variant?: 'note' | 'murmur';
}

const { prefix, variant = 'note' } = Astro.props;

// Fun prefixes that give Clawd personality - 鄉民/李宏毅 style
const notePrefixes = [
  'Clawd 碎碎念：',
  'Clawd 忍不住說：',
  'Clawd 想補充：',
  'Clawd OS：',
  'Clawd 內心戲：',
  'Clawd 歪樓一下：',
  'Clawd murmur：',
  'Clawd 插嘴：',
  'Clawd 溫馨提示：',
  'Clawd 真心話：',
  'Clawd 吐槽時間：',
  'Clawd 認真說：',
  'Clawd 補個刀：',
  'Clawd 偷偷說：',
  'Clawd 畫重點：',
];

const murmurPrefixes = [
  'Clawd 碎碎念：',
  'Clawd 偷偷講：',
  'Clawd 內心小劇場：',
  'Clawd 的 murmur：',
  'Clawd 嘀咕一下：',
];

const prefixes = variant === 'murmur' ? murmurPrefixes : notePrefixes;

// Get the slot content for hashing
const slotContent = await Astro.slots.render('default');

// Simple hash function based on content
function hashString(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = (hash << 5) - hash + char;
    hash = hash & hash; // Convert to 32bit integer
  }
  return Math.abs(hash);
}

// Select prefix based on content hash (deterministic but varied)
const contentHash = hashString(slotContent);
const selectedPrefix = prefix || prefixes[contentHash % prefixes.length];
const isNote = variant === 'note';
---

<blockquote class:list={['claude-note', { 'claude-note--murmur': !isNote }]}>
  <strong class="clawd-prefix">
    <img src="/clawd-picks-icon.png" alt="Clawd" class="clawd-prefix-icon" width="20" height="20" />
    {selectedPrefix}
  </strong>
  <br />
  <Fragment set:html={slotContent} />
</blockquote>

<style>
  .clawd-prefix {
    color: #cb7551;
    font-size: 0.95em;
    display: flex;
    align-items: center;
    gap: 0.35rem;
    margin-bottom: 0.3rem;
  }

  .clawd-prefix-icon {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
  }

  /* Murmur variant styling */
  .claude-note--murmur {
    border-left-color: #9d7cd8 !important;
    background: rgba(157, 124, 216, 0.06) !important;
    font-style: italic;
    border-radius: 0 12px 12px 0 !important;
    padding: 1rem 1.25rem !important;
  }

  .claude-note--murmur .clawd-prefix {
    color: #9d7cd8;
  }

  /* Light theme murmur */
  [data-theme='light'] .claude-note--murmur {
    border-left-color: #6c71c4 !important;
    background: rgba(108, 113, 196, 0.06) !important;
  }

  [data-theme='light'] .claude-note--murmur .clawd-prefix {
    color: #6c71c4;
  }
</style>
