---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Toggle from '../../components/Toggle.astro';
---

<BaseLayout title="Obsidian & Claude Code 101: Context Engineering - gu-log">
  <article class="post">
    <header class="post-header">
      <h1>Obsidian & Claude Code 101: Context Engineering</h1>
      <p class="post-meta">2026-01-30 · 完整翻譯</p>
    </header>

    <div class="source-citation">
      <strong>原文出處：</strong>
      <a href="https://x.com/arscontexta/status/2015585363318743071" target="_blank" rel="noopener">
        @arscontexta (Heinrich) on X
      </a>
    </div>

    <div class="post-content">

      <p>
        Vibe note-taking 要運作得好，你必須強迫 Claude Code <strong>「挑食」</strong>一點。
      </p>

      <p>
        預設情況下，只要看起來有用，Claude 就會把整個檔案讀進去。這樣很快就會塞爆 context window。
      </p>

      <p>
        我們要用 4 層過濾機制來讓它更選擇性。這個 pattern 叫做 <strong>Progressive Disclosure（漸進式揭露）</strong>。
      </p>

      <blockquote class="claude-note">
        <strong>Claude：</strong>Progressive Disclosure 是 UI 設計的老觀念，現在用在 AI Context 上也很合。就像約會一樣，不要第一次見面就把祖宗十八代都交代清楚。循序漸進，有興趣再深入。
      </blockquote>

      <h2>1. File Tree (檔案樹)</h2>

      <p>
        在 session 開始時，透過 hook 自動注入完整的檔案樹，這時候 Claude 還沒碰任何東西。
      </p>

      <pre><code>{`"hooks": {
    "SessionStart": [{
        "hooks": [{
            "type": "command",
            "command": "tree -L 3 -a -I '.git|.obsidian' --noreport"
        }]
    }]
}`}</code></pre>

      <p>
        這給了 Claude 一張地圖。
      </p>

      <p>
        <strong>檔名要有描述性</strong>，這樣它們才能作為第一印象。
      </p>

      <p>
        <code>queries evolve during search so agents should checkpoint md</code>
      </p>

      <p>
        這個檔名比 <code>search notes md</code> 告訴你更多資訊。光讀檔案樹就知道筆記在講什麼。
      </p>

      <h2>2. YAML Descriptions (摘要描述)</h2>

      <p>
        每一則筆記在 frontmatter 都有一個單句描述。
      </p>

      <pre><code>---
description: Memory retrieval in brains works through spreading activation where neighbors prime each other. Wiki link traversal replicates this, making backlinks function as primes that surface relevant contexts
---
# spreading activation models how agents should traverse
...</code></pre>

      <p>
        描述是對標題的補充說明。如果某個東西看起來有趣，Claude 會用 <code>ripgrep</code> 查詢它：
      </p>

      <pre><code>rg "^description:" 01_thinking/*.md</code></pre>

      <blockquote class="claude-note">
        <strong>Claude：</strong>這就像給每篇筆記寫個 Tweet。AI 讀 Tweet 就知道這篇在講什麼，不用讀整篇長文。這對省 token 超級有幫助。
      </blockquote>

      <h2>3. Outline (大綱)</h2>

      <p>
        如果一則筆記通過了描述過濾器，Claude 接著檢查大綱。
      </p>

      <p>
        有時候你只需要其中一個章節，載入整個檔案會製造雜訊。
      </p>

      <pre><code>grep -n "^#" "01_thinking/knowledge-work.md"
# output:
# 5:# knowledge-work
# 13:## Core Ideas
# 19:## Tensions
# 23:## Gaps</code></pre>

      <p>
        現在 Claude 知道要看哪裡，只讀它需要的部分。
      </p>

      <h2>4. Full Content (完整內容)</h2>

      <p>
        如果一切看起來都跟任務相關，Claude 才會載入完整檔案。
      </p>

      <p>
        <strong>但只針對通過前三層過濾的筆記。</strong>
      </p>

      <p>
        大部分筆記永遠不會進到這一層，這就是重點。當 Claude 必須為每一次讀取辯護時，它的策展能力會變好。
      </p>

      <h2>MCP 的平行概念</h2>

      <p>
        這不是新 pattern。MCP (Model Context Protocol) 的工具發現也是這樣運作的。
      </p>

      <p>
        當你有 50+ 個工具，Claude 不會把所有定義都一開始就載入。工具規格是可用的，但推遲到 Claude 實際搜尋它們時才載入。
      </p>

      <pre><code>tool list → tool search → tool references → full definitions</code></pre>

      <p>同樣的結構：</p>

      <pre><code>file tree → descriptions → outline → full content</code></pre>

      <h2>實作方式</h2>

      <p>整件事其實只有三步：</p>

      <ol>
        <li>一個跑 <code>tree</code> 的 SessionStart hook</li>
        <li>有 description 欄位的 YAML frontmatter</li>
        <li>在 CLAUDE.md 裡的指令，叫 Claude 在讀取前先檢查 descriptions</li>
      </ol>

      <p>
        只需幾個限制，就能強迫它變得挑惕。
      </p>

      <hr/>

      <h2>社群精選問答</h2>

      <Toggle title="Q: 每一篇都要手寫 YAML 描述很累欸？">
        <p><strong>@Catcher4242 問：</strong> 這前提是每則筆記都要有 description。有自動化的替代方案嗎？手動寫或跑批次生成好像都很貴/很累。</p>
        <p><strong>Heinrich 霸氣回：</strong> <strong>Just tell Claude.</strong>（叫 Claude 做就好）</p>
        <blockquote class="claude-note">
          <strong>Claude：</strong>這是這套系統的精髓。覺得寫 YAML 很累？叫 Claude 幫你寫啊。它是你的員工，不是你的老闆。你可以下個指令：「幫我整理這篇筆記並補上 description」，搞定。
        </blockquote>
      </Toggle>

      <Toggle title="其他有趣的 hook">
        <p><strong>Heinrich 分享：</strong> @lt0gt 用了類似的 hook 但帶更多 context，讓我想要重新思考我的作法。</p>
        <p>他會把最近的 context + 可用工具都在 session 開始時注入。</p>
      </Toggle>

    </div>

    <footer class="post-footer">
      <a href="/posts/claude-obsidian-infrastructure">← 返回系列總覽</a>
    </footer>
  </article>
</BaseLayout>

<style>
  .post-header {
    margin-bottom: 1.5rem;
  }

  .post-header h1 {
    margin-bottom: 0.5rem;
  }

  .post-content {
    margin: 1.5rem 0;
  }

  .post-content blockquote {
    font-style: normal;
  }

  .post-content blockquote.claude-note {
    background: var(--color-surface);
    border-left-color: var(--color-accent);
    padding: 0.75rem 1rem;
    border-radius: 0 8px 8px 0;
  }

  .post-content pre {
    overflow-x: auto;
  }

  .post-content hr {
    margin: 2rem 0;
    border: none;
    border-top: 1px solid var(--color-border);
  }

  .post-footer {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border);
  }
</style>
