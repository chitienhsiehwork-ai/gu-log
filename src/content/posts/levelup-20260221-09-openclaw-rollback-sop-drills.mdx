---
ticketId: "Lv-09"
title: "OpenClaw Health Suiteï¼ˆä¸‹ï¼‰ï¼šRollbackã€SOP èˆ‡æ•…éšœæ¼”ç·´"
originalDate: "2026-02-21"
source: "Level-Up ç³»åˆ—"
sourceUrl: "https://gu-log.vercel.app/posts/levelup-20260221-09-openclaw-rollback-sop-drills"
summary: "Lv-09 æ¥çºŒ Lv-08ï¼Œä¸‹åŠå ´å°ˆè¬› Recover Layerã€‚æ‹†è§£ rollback å®‰å…¨è¨­è¨ˆã€å‡ç´š SOP æ±ºç­–æ¨¹ã€`|| true` showstopper review dramaï¼Œæœ€å¾Œçµ¦å‡ºå¯åŸ·è¡Œçš„ drill KPIã€‚"
lang: "zh-tw"
tags: ["openclaw", "rollback", "sop", "sre", "incident-response", "bash", "tutorial", "level-up"]
---

import LevelUpProgress from '../../components/LevelUpProgress.astro';
import LevelUpQuiz from '../../components/LevelUpQuiz.astro';
import ClawdNote from '../../components/ClawdNote.astro';
import AnalogyBox from '../../components/AnalogyBox.astro';

æ­¡è¿ä¾†åˆ° Level-Up ç³»åˆ—ç¬¬ä¹ç¯‡ã€‚

ä¸Šä¸€ç¯‡ Lv-08ï¼ˆä¸Šï¼‰æˆ‘å€‘å…ˆæŠŠ Detect Layer è¬›å®Œï¼š
ä½ è¦å…ˆçŸ¥é“ã€Œç³»çµ±æ­£åœ¨æ­»ã€ã€‚

é€™ç¯‡ Lv-09ï¼ˆä¸‹ï¼‰åªåšä¸€ä»¶äº‹ï¼š
**çŸ¥é“å¿«æ­»äº†ä¹‹å¾Œï¼Œæ€éº¼ç©©å®šæ•‘å›ä¾†ã€‚**

---

## ğŸ° Floor 0ï¼šRecover Layer çš„è¨­è¨ˆåŸå‰‡

<LevelUpProgress current={0} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

Recover ä¸æ˜¯ã€Œè¶Šè‡ªå‹•è¶Šå¥½ã€ï¼Œè€Œæ˜¯ã€Œè¶Šå¯æ§è¶Šå¥½ã€ã€‚

ä¸‰æ¢åº•ç·šï¼š

- **å¯é©—è­‰**ï¼šæ¯æ¬¡é‚„åŸéƒ½è¦èƒ½é©—è­‰ä¾†æºèˆ‡å®Œæ•´æ€§
- **å¯ä¸­æ­¢**ï¼šé è¨­å…ˆ dry-runï¼Œé¿å…èª¤æ‰‹è¡“
- **å¯é‡è¤‡**ï¼šæµç¨‹å¯«é€² SOPï¼Œä¸é è‹±é›„è¨˜æ†¶

æ‰€ä»¥é€™ç¯‡æ ¸å¿ƒæ˜¯å…©å€‹æ±è¥¿ï¼š

- `openclaw-rollback.sh`
- `openclaw-upgrade-sop.md`

<ClawdNote>
SRE ä¸–ç•Œè£¡æœ€å±éšªçš„äººä¸æ˜¯æ–°æ‰‹ï¼Œæ˜¯ã€Œè‡ªèªå¾ˆç†Ÿæ‰€ä»¥ä¸çœ‹ SOPã€çš„è€æ‰‹ã€‚é€™å¥è©±çœŸçš„è¡€æ·šã€‚
</ClawdNote>

---

## ğŸ° Floor 1ï¼šRollback æ·±æ½›ï¼ˆ378 è¡Œ emergency surgeryï¼‰

<LevelUpProgress current={1} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

`openclaw-rollback.sh` ä¸æ˜¯é‡å•Ÿè…³æœ¬ï¼Œå®ƒæ˜¯æœ‰è­·æ¬„çš„æ‰‹è¡“æµç¨‹ã€‚

å…ˆè¨˜ CLIï¼š

```bash
openclaw-rollback.sh --dry-run
openclaw-rollback.sh --confirm
openclaw-rollback.sh --auto-confirm
```

é è¨­ä¸å¸¶åƒæ•¸ = `--dry-run`ã€‚é€™ä¸æ˜¯å®¢æ°£ï¼Œæ˜¯ safety defaultã€‚

å¯¦éš›æ­¥é©Ÿï¼š

1. æ‰¾æœ€æ–° rollback package
2. é©—è­‰ `manifest.json` SHA256
3. åµæ¸¬ç›®å‰ service mode
4. `pkill -f` æ¸…æ‰æ‰€æœ‰ gateway processï¼ˆå« rogue nohupï¼‰
5. é‚„åŸ config/auth/service/drop-ins
6. æŒ‰åµæ¸¬æ¨¡å¼é‡å•Ÿ
7. è·‘ healthcheck é©—è­‰å›å¾©çµæœ

æœ€å¯¦æˆ°çš„åœ°æ–¹æ˜¯ **service mode detection**ã€‚
äº‹æ•…æœŸé–“å¯èƒ½å‡ºç¾é€™å¹¾ç¨®ç‹€æ…‹ï¼š

- user systemd active
- system systemd active
- manual nohup running
- dual modeï¼ˆåŒæ™‚åœ¨è·‘ï¼‰

å¦‚æœä¸å…ˆåˆ¤æ–· modeï¼Œrollback å¾ˆå®¹æ˜“ã€Œæª”æ¡ˆæ¢å¾©æˆåŠŸï¼Œä½†æœå‹™å•Ÿåœ¨éŒ¯åœ°æ–¹ã€ã€‚

<AnalogyBox title="ğŸ¥ æ€¥è¨ºæµç¨‹é¡æ¯”">

é†«ç”Ÿçœ‹åˆ°ç—…äººä¸æœƒå…ˆå‹•åˆ€ï¼Œè€Œæ˜¯å…ˆåˆ†ç´šï¼šæ€¥è¨ºï¼Ÿå¤–ç§‘ï¼Ÿå…§ç§‘ï¼Ÿ

rollback ä¹Ÿæ˜¯ä¸€æ¨£ï¼šå…ˆè¾¨è­˜é‹è¡Œæ¨¡å¼ï¼Œå†å‹•æ‰‹ï¼Œæ‰èƒ½é¿å…äºŒæ¬¡å‚·å®³ã€‚

</AnalogyBox>

<LevelUpQuiz
  question="Rollback ç‚ºä»€éº¼ä¸èƒ½ç›´æ¥ã€ä¸€éµ hard restoreã€ï¼Ÿ"
  options={[
    { label: "A", text: "å› ç‚º bash ä¸æ”¯æ´ä¸€éµ" },
    { label: "B", text: "å› ç‚ºç¾å ´æ¨¡å¼ï¼ˆsystemd/nohup/dualï¼‰å¯èƒ½ä¸åŒï¼Œä¸å…ˆè¾¨è­˜æœƒé‚„åŸåˆ°éŒ¯èª¤åŸ·è¡Œé¢" },
    { label: "C", text: "å› ç‚ºé‚„åŸé€Ÿåº¦å¤ªæ…¢" },
    { label: "D", text: "å› ç‚º SHA256 å¤ªé‡" },
  ]}
  answer="B"
  explanation="Recover æœ€æ€•ã€çœ‹èµ·ä¾†æˆåŠŸä½†å…¶å¯¦æ²’æ¢å¾©æœå‹™ã€ã€‚å…ˆåµæ¸¬ service modeï¼Œæ˜¯é¿å…å‡æˆåŠŸçš„é—œéµã€‚"
/>

---

## ğŸ° Floor 2ï¼šUpgrade SOPï¼ˆäººé¡æ˜¯æœ€å¾Œä¸€å±¤ä¿éšªï¼‰

<LevelUpProgress current={2} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

`openclaw-upgrade-sop.md` æ˜¯äººé¡æµç¨‹ï¼Œä¸æ˜¯è…³æœ¬ã€‚

ä¸»æµç¨‹å…«æ­¥ï¼š

1. stop watchdog timer
2. `pre-update`ï¼ˆsnapshot + rollback packageï¼‰
3. å‡ç´š OpenClaw
4. **æª¢æŸ¥ `OPENCLAW_NO_RESPAWN=1`ï¼ˆæœ€é—œéµé–˜é–€ï¼‰**
5. daemon-reload + restart
6. `post-update` gate
7. resume watchdog
8. è§€å¯Ÿ quick verify 5 åˆ†é˜

Decision tree é‡é»ï¼š

- é‡åˆ° `pairing required` / `scope-upgrade`
  - å…ˆ `openclaw onboard`ï¼ˆé‡é…å°ï¼‰
  - ä¸æ˜¯ç¬¬ä¸€æ™‚é–“ rollback
- critical fail æŒçºŒä¸è§£
  - èµ° `openclaw-rollback.sh --confirm`

<ClawdNote variant="murmur">
é€™ä»½ SOP çš„ç²¾ç¥æ˜¯ã€Œå…ˆæœ€å°æˆæœ¬ä¿®å¾©ï¼Œå†é€²å…¥é«˜é¢¨éšªæ‰‹è¡“ã€ã€‚ä¸æ˜¯æ¯å€‹ç´…å­—éƒ½è¦æ ¸å½ˆç´š rollbackã€‚
</ClawdNote>

<LevelUpQuiz
  question="ç‚ºä»€éº¼ SOP æŠŠ `OPENCLAW_NO_RESPAWN=1` è¨­æˆç¡¬æ€§ gateï¼Ÿ"
  options={[
    { label: "A", text: "å› ç‚ºçœ‹èµ·ä¾†å¾ˆå°ˆæ¥­" },
    { label: "B", text: "å› ç‚ºå®ƒç›´æ¥å°æ‡‰äº‹æ•…æ ¹å› ï¼Œå¯é¿å… restart hydra é‡ç¾" },
    { label: "C", text: "å› ç‚º systemd è¦æ±‚å¿…å¡«" },
    { label: "D", text: "å› ç‚º watchdog ä¸èƒ½è®€å…¶ä»–è®Šæ•¸" },
  ]}
  answer="B"
  explanation="äº‹æ•…ä¸­æœ€è‡´å‘½çš„æ˜¯ self-respawn æ”¾å¤§æ©Ÿåˆ¶ã€‚é€™å€‹ gate æ˜¯æŠŠè¡€çš„æ•™è¨“è®Šæˆæµç¨‹ç´„æŸã€‚"
/>

---

## ğŸ° Floor 3ï¼šReview Dramaï¼ˆ`|| true` showstopperï¼‰

<LevelUpProgress current={3} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

é€™å€‹æ¡ˆå­æœ€æœ‰æ•™è‚²åƒ¹å€¼çš„åœ°æ–¹åœ¨ code reviewã€‚

ç¬¬ä¸€è¼ª review æŠ“åˆ° 14 å€‹é»ï¼Œå…¶ä¸­ä¸€å€‹æ˜¯ **CRITICAL showstopper**ï¼š

```bash
set -euo pipefail
verify_json="$(openclaw-healthcheck.sh verify --quick --json || true)"
rc=$?
# rc æ°¸é æ˜¯ 0ï¼ˆæŠ“åˆ° true çš„ exit codeï¼‰
```

é€™æœƒå°è‡´ watchdog æ°¸é åˆ¤å®šã€Œå¥åº·ã€ï¼Œç­‰æ–¼ä½ çš„ safety net æœ‰æ´ã€‚

ä¿®æ³•æ”¹æˆ parse JSONï¼Œè€Œä¸æ˜¯è¿·ä¿¡ `$?`ï¼š

```bash
verify_json="$(openclaw-healthcheck.sh verify --quick --json || true)"
failed_critical=$(echo "$verify_json" | jq -r '.failed_critical // 0')

if [[ "$failed_critical" -gt 0 ]]; then
  handle_failure "$verify_json"
fi
```

ä½†åŠ‡æƒ…é‚„æœ‰ä¸‹åŠï¼š
Codex å° review çš„ 3 æ¢æå‡ºåé§ï¼ŒæŒ‡å‡º reviewer åƒè€ƒçš„æ˜¯èˆŠç‰ˆ specï¼ˆv2/v3ï¼‰ï¼Œä¸æ˜¯æœ€çµ‚ v4ã€‚å¾Œä¾†ç¢ºèªé€™ 3 æ¢ pushback éƒ½æˆç«‹ã€‚

é€™æ®µè¶…é‡è¦ï¼š

- reviewer èƒ½æŠ“å‡ºè‡´å‘½ bug
- implementer ä¹Ÿèƒ½ç³¾æ­£ reviewer
- å¤šä»£ç†å”ä½œçš„åƒ¹å€¼åœ¨ã€Œå¯è³ªç–‘ã€å¯é©—è­‰ã€

<LevelUpQuiz
  question="é€™æ®µ review drama æœ€å€¼å¾—æŠ„çš„åœ˜éšŠç¿’æ…£æ˜¯ï¼Ÿ"
  options={[
    { label: "A", text: "review æ„è¦‹å…¨éƒ¨ç…§å–®å…¨æ”¶" },
    { label: "B", text: "ä»¥è·ä½é«˜ä½æ±ºå®šèª°å°" },
    { label: "C", text: "ä»»ä½•ä¸»å¼µéƒ½è¦å›åˆ°æœ€æ–°ç‰ˆ spec èˆ‡å¯é©—è­‰è­‰æ“š" },
    { label: "D", text: "æœ‰ AI å°±ä¸éœ€è¦äºŒæ¬¡ review" },
  ]}
  answer="C"
  explanation="å¥åº·å”ä½œä¸æ˜¯æœå¾ï¼Œè€Œæ˜¯ evidence-basedã€‚é€™æ¬¡åŒæ™‚è­‰æ˜ reviewer èˆ‡ implementer éƒ½å¯èƒ½éƒ¨åˆ†æ­£ç¢ºã€‚"
/>

---

## ğŸ° Floor 4ï¼šDrill è¨­è¨ˆï¼ˆæŠŠå·¥å…·è®Šæˆèƒ½åŠ›ï¼‰

<LevelUpProgress current={4} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

æœ‰å·¥å…·ä¸ä»£è¡¨æœ‰èƒ½åŠ›ã€‚èƒ½åŠ›ä¾†è‡ª drillã€‚

é€™å¥— Health Suite çš„é©—æ”¶ KPIï¼š

- upgrade drillï¼šâ‰¤ 5 åˆ†é˜
- rollback drillï¼šâ‰¤ 3 åˆ†é˜
- alert latencyï¼šâ‰¤ 5 åˆ†é˜
- restart stormï¼š72h è§€å¯ŸæœŸå…§ 0 æ¬¡

å»ºè­°æœ€å° drill å¥—é¤ï¼š

1. æ¨¡æ“¬é…ç½®éŒ¯èª¤ï¼ˆå¯å›å¾©ï¼‰
2. ç¢ºèª watchdog åœ¨ SLA å…§å‘Šè­¦
3. åŸ·è¡Œ rollbackï¼ˆå…ˆ dry-run å† confirmï¼‰
4. è·‘ post-rollback healthcheck
5. è¨˜éŒ„ MTTR èˆ‡åå·®åŸå› 

<AnalogyBox title="ğŸ§¯ æ¶ˆé˜²æ¼”ç·´é¡æ¯”">

ä½ ä¸æœƒç­‰ç«ç½æ‰å­¸æ€éº¼é€ƒç”Ÿï¼›ä½ è¦åœ¨å¹³å¸¸å°±æ¼”ç·´ã€‚rollback ä¹Ÿæ˜¯ï¼Œå¹³å¸¸ä¸æ¼”ï¼ŒçœŸçš„å‡ºäº‹åªæœƒ panicã€‚

</AnalogyBox>

<ClawdNote>
æˆ‘æœ€æ¨çš„ä¸€æ¢ï¼šæ¯æ¬¡ drill éƒ½è¦ç•™ä¸‹ã€Œé€™æ¬¡æ¯”ä¸Šæ¬¡å¿«/æ…¢åœ¨å“ªã€çš„è¨»è¨˜ã€‚ä¸ç„¶ä½ åªæ˜¯åè¦†åšå„€å¼ï¼Œæ²’æœ‰æŒçºŒé€²åŒ–ã€‚
</ClawdNote>

---

## ğŸ° Floor 5ï¼šLv-09 ç¸½çµï¼ˆRecover Layer å®Œæˆï¼‰

<LevelUpProgress current={5} total={6} title="OpenClaw Health Suiteï¼ˆä¸‹ï¼‰" />

Lv-08 + Lv-09 åˆèµ·ä¾†ï¼Œæ‰æ˜¯å®Œæ•´ Health Suiteï¼š

- **Lv-08ï¼ˆä¸Šï¼‰**ï¼šDetect Layerï¼ˆHealthcheck + Watchdogï¼‰
- **Lv-09ï¼ˆä¸‹ï¼‰**ï¼šRecover Layerï¼ˆRollback + SOP + Drillï¼‰

ä¸€å¥è©±ç¸½çµï¼š

> ä½ ä¸å¯èƒ½æ°¸é ä¸å‡ºäº‹ï¼Œä½†ä½ å¯ä»¥æŠŠæ¯æ¬¡å‡ºäº‹éƒ½è®ŠçŸ­ã€è®Šå¯æ§ã€è®Šå¯é‡è¤‡ã€‚

é€™æ‰å« production readinessã€‚

å®Œã€‚
