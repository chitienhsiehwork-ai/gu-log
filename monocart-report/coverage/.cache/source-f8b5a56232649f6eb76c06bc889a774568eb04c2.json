{"id":"f8b5a56232649f6eb76c06bc889a774568eb04c2","url":"http://localhost:4321/posts/sqaa-levelup-journey","source":"(function(){const apiUrl = \"http://localhost:8787\";\nconst lang = \"zh-tw\";\n\n  const JWT_KEY = 'gu-log-jwt';\n  const RETURN_KEY = 'gu-log-return-url';\n  \n  function getJwt() {\n    try { return localStorage.getItem(JWT_KEY); } catch(e) { return null; }\n  }\n\n  function parseJwt(token) {\n    try {\n      const base64 = token.split('.')[1];\n      const json = atob(base64.replace(/-/g, '+').replace(/_/g, '/'));\n      return JSON.parse(json);\n    } catch(e) { return null; }\n  }\n\n  function render() {\n    const container = document.querySelector('[data-login-cta]');\n    const content = document.getElementById('login-cta-content');\n    if (!container || !content) return;\n\n    const jwt = getJwt();\n    let email = null;\n    if (jwt) {\n      const payload = parseJwt(jwt);\n      email = (payload && (payload.email || payload.login || payload.sub)) || '?';\n    }\n\n    if (email) {\n      // Logged in\n      content.innerHTML = `\n        <div class=\"cta-title\">${lang === 'en' ? 'Select text to use AI features' : '選取文章中的文字來使用 AI 功能'}</div>\n        <div class=\"cta-status\">\n          ${lang === 'en' ? 'Logged in as' : '已登入'}：${email} \n          <button id=\"cta-logout-btn\" class=\"cta-logout\">[${lang === 'en' ? 'Logout' : 'Logout'}]</button>\n        </div>\n      `;\n      \n      // Use setTimeout to ensure DOM is updated\n      setTimeout(() => {\n        document.getElementById('cta-logout-btn')?.addEventListener('click', () => {\n          localStorage.removeItem(JWT_KEY);\n          render();\n        });\n      }, 0);\n    } else {\n      // Not logged in\n      content.innerHTML = `\n        <div class=\"cta-title\">${lang === 'en' ? 'Want to improve this article?' : '想幫忙改進這篇文章？'}</div>\n        <div class=\"cta-desc\">\n          ${lang === 'en' ? 'Log in to use AI features:' : '登入後可以用 AI 功能：'}\n          <ul class=\"cta-features\">\n            <li>${lang === 'en' ? 'Ask AI — Select text to explain (coming soon)' : 'Ask AI — 選取文字，AI 幫你解釋（之後會做）'}</li>\n            <li>${lang === 'en' ? 'Edit — Select text to suggest edits (coming soon)' : 'Edit — 選取文字，AI 建議修改（之後會做）'}</li>\n          </ul>\n        </div>\n        <div class=\"cta-action\">\n          <a href=\"${apiUrl}/auth/github\" id=\"cta-login-btn\" class=\"github-login-btn\">\n            <svg height=\"20\" width=\"20\" viewBox=\"0 0 16 16\" version=\"1.1\" aria-hidden=\"true\">\n              <path fill=\"currentColor\" d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z\"></path>\n            </svg>\n            <span>Login with GitHub</span>\n          </a>\n        </div>\n      `;\n\n      setTimeout(() => {\n        document.getElementById('cta-login-btn')?.addEventListener('click', () => {\n          try {\n            localStorage.setItem(RETURN_KEY, window.location.href);\n          } catch(e) {}\n        });\n      }, 0);\n    }\n\n    container.style.display = 'block';\n  }\n\n  // Run on load\n  render();\n  \n  // Re-run if localStorage changes (e.g. from another tab)\n  window.addEventListener('storage', (e) => {\n    if (e.key === JWT_KEY) render();\n  });\n})();"}