{"id":"41314fe636ccab8ee41e530d1bee74f17cc16042","url":"http://localhost:4321/src/components/Mermaid.astro?astro&type=script&index=0&lang.ts","source":"async function initMermaidDiagrams() {\n  const { default: mermaid } = await import(\"https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs\");\n  mermaid.initialize({\n    startOnLoad: false,\n    theme: \"base\",\n    look: \"handDrawn\",\n    themeVariables: {\n      primaryColor: \"#fdf6e3\",\n      primaryTextColor: \"#657b83\",\n      primaryBorderColor: \"#93a1a1\",\n      lineColor: \"#93a1a1\",\n      secondaryColor: \"#eee8d5\",\n      tertiaryColor: \"#fdf6e3\",\n      noteTextColor: \"#657b83\",\n      noteBkgColor: \"#eee8d5\",\n      fontFamily: '\"Virgil\", \"LXGW WenKai TC\", cursive, system-ui'\n    },\n    flowchart: { htmlLabels: true, curve: \"basis\" },\n    securityLevel: \"loose\"\n  });\n  const wrappers = document.querySelectorAll(\".mermaid-wrapper\");\n  const allDefs = [];\n  for (const w of wrappers) {\n    const s = w.querySelector(\".mermaid-source\");\n    if (s) allDefs.push(s.textContent || \"\");\n  }\n  const cjkChars = allDefs.join(\"\").replace(/[^\\u4e00-\\u9fff\\u3400-\\u4dbf]/g, \"\");\n  if (cjkChars) {\n    const probe = document.createElement(\"span\");\n    probe.style.cssText = 'font-family:\"LXGW WenKai TC\",cursive;position:absolute;left:-9999px;visibility:hidden;font-size:16px';\n    probe.textContent = cjkChars;\n    document.body.appendChild(probe);\n    const probeV = document.createElement(\"span\");\n    probeV.style.cssText = 'font-family:\"Virgil\",cursive;position:absolute;left:-9999px;visibility:hidden;font-size:16px';\n    probeV.textContent = \"ABCabc123\";\n    document.body.appendChild(probeV);\n    await document.fonts.ready;\n    probe.remove();\n    probeV.remove();\n  }\n  for (const wrapper of wrappers) {\n    const source = wrapper.querySelector(\".mermaid-source\");\n    const renderTarget = wrapper.querySelector(\".mermaid-render\");\n    const expandBtn = wrapper.querySelector(\".mermaid-expand-btn\");\n    const overlay = wrapper.nextElementSibling;\n    if (!source || !renderTarget) continue;\n    const def = source.textContent?.trim() || \"\";\n    const id = `mermaid-${Math.random().toString(36).slice(2, 9)}`;\n    try {\n      const { svg } = await mermaid.render(id, def);\n      renderTarget.innerHTML = svg;\n    } catch (e) {\n      renderTarget.innerHTML = `<pre style=\"color:#dc322f;font-size:0.8rem;\">Mermaid error: ${e}</pre>`;\n      continue;\n    }\n    if (expandBtn && overlay) {\n      const overlayContent = overlay.querySelector(\".mermaid-overlay-content\");\n      const closeBtn = overlay.querySelector(\".mermaid-close-btn\");\n      expandBtn.addEventListener(\"click\", () => {\n        if (overlayContent) {\n          overlayContent.innerHTML = renderTarget.innerHTML;\n        }\n        overlay.style.display = \"flex\";\n        document.body.style.overflow = \"hidden\";\n      });\n      const closeOverlay = () => {\n        overlay.style.display = \"none\";\n        document.body.style.overflow = \"\";\n      };\n      closeBtn?.addEventListener(\"click\", closeOverlay);\n      overlay.addEventListener(\"click\", (e) => {\n        if (e.target === overlay) closeOverlay();\n      });\n    }\n  }\n}\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", initMermaidDiagrams);\n} else {\n  initMermaidDiagrams();\n}\ndocument.addEventListener(\"astro:page-load\", initMermaidDiagrams);\n","sourceMap":{"version":3,"sources":["Mermaid.astro"],"sourcesContent":["---\n/**\n * Mermaid diagram component\n * - Renders Mermaid diagrams client-side\n * - Scrollable horizontally on mobile\n * - Tap to expand fullscreen (pinch-to-zoom friendly)\n *\n * Usage in MDX:\n *   <Mermaid chart={`graph TB\\n  A-->B`} caption=\"My diagram\" />\n */\ninterface Props {\n  /** Mermaid diagram definition (pass as template literal) */\n  chart: string;\n  /** Optional caption below the diagram */\n  caption?: string;\n}\n\nconst { chart, caption } = Astro.props;\n---\n\n<div class=\"mermaid-wrapper\">\n  <div class=\"mermaid-scroll\">\n    <div class=\"mermaid-source\" style=\"display:none;\" data-mermaid>{chart}</div>\n    <div class=\"mermaid-render\"></div>\n  </div>\n  {caption && <p class=\"mermaid-caption\">{caption}</p>}\n  <button class=\"mermaid-expand-btn\" aria-label=\"展開圖表\" title=\"點擊放大\">\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      stroke-width=\"2\"\n    >\n      <path d=\"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7\"></path>\n    </svg>\n  </button>\n</div>\n\n<!-- Fullscreen overlay (one per diagram, activated by JS) -->\n<div class=\"mermaid-overlay\" style=\"display:none;\">\n  <button class=\"mermaid-close-btn\" aria-label=\"關閉\">✕</button>\n  <div class=\"mermaid-overlay-content\"></div>\n</div>\n\n<style>\n  @import url('https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&display=swap');\n\n  @font-face {\n    font-family: 'Virgil';\n    src: url('https://excalidraw.com/Virgil.woff2') format('woff2');\n    font-display: swap;\n  }\n\n  .mermaid-wrapper {\n    position: relative;\n    margin: 1.5rem 0;\n    border: 1px solid var(--border-color, #e0d8c8);\n    border-radius: 8px;\n    overflow: hidden;\n    background: var(--code-bg, #fdf6e3);\n  }\n\n  .mermaid-scroll {\n    overflow-x: auto;\n    overflow-y: hidden;\n    -webkit-overflow-scrolling: touch;\n    padding: 1rem;\n    min-height: 100px;\n    display: flex;\n    justify-content: center;\n  }\n\n  .mermaid-render {\n    min-width: fit-content;\n  }\n\n  .mermaid-render :global(svg) {\n    max-width: none;\n    height: auto;\n  }\n\n  .mermaid-caption {\n    text-align: center;\n    font-size: 0.85rem;\n    color: var(--text-muted, #93a1a1);\n    margin: 0;\n    padding: 0.5rem 1rem 0.75rem;\n    border-top: 1px solid var(--border-color, #e0d8c8);\n  }\n\n  .mermaid-expand-btn {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    background: var(--code-bg, #fdf6e3);\n    border: 1px solid var(--border-color, #e0d8c8);\n    border-radius: 4px;\n    padding: 4px 6px;\n    cursor: pointer;\n    opacity: 0.6;\n    transition: opacity 0.2s;\n    color: var(--text-color, #657b83);\n    z-index: 1;\n  }\n\n  .mermaid-expand-btn:hover {\n    opacity: 1;\n  }\n\n  /* Fullscreen overlay */\n  .mermaid-overlay {\n    position: fixed;\n    inset: 0;\n    z-index: 9999;\n    background: #fdf6e3;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    touch-action: pan-x pan-y pinch-zoom;\n  }\n\n  .mermaid-overlay-content {\n    padding: 2rem;\n    max-width: 95vw;\n    max-height: 95vh;\n    overflow: auto;\n  }\n\n  .mermaid-overlay-content :global(svg) {\n    max-width: none;\n    height: auto;\n  }\n\n  .mermaid-close-btn {\n    position: fixed;\n    top: 16px;\n    right: 16px;\n    z-index: 10000;\n    background: rgba(0, 0, 0, 0.1);\n    border: none;\n    color: #657b83;\n    font-size: 1.5rem;\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .mermaid-close-btn:hover {\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  /* Loading state */\n  .mermaid-render:empty::after {\n    content: '載入圖表中...';\n    color: var(--text-muted, #93a1a1);\n    font-size: 0.85rem;\n  }\n</style>\n\n<script>\n  // Initialize all Mermaid diagrams on page load\n  async function initMermaidDiagrams() {\n    const { default: mermaid } =\n      await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs');\n\n    mermaid.initialize({\n      startOnLoad: false,\n      theme: 'base',\n      look: 'handDrawn',\n      themeVariables: {\n        primaryColor: '#fdf6e3',\n        primaryTextColor: '#657b83',\n        primaryBorderColor: '#93a1a1',\n        lineColor: '#93a1a1',\n        secondaryColor: '#eee8d5',\n        tertiaryColor: '#fdf6e3',\n        noteTextColor: '#657b83',\n        noteBkgColor: '#eee8d5',\n        fontFamily: '\"Virgil\", \"LXGW WenKai TC\", cursive, system-ui',\n      },\n      flowchart: { htmlLabels: true, curve: 'basis' },\n      securityLevel: 'loose',\n    });\n\n    const wrappers = document.querySelectorAll('.mermaid-wrapper');\n\n    // Collect all Chinese chars from diagrams to force-trigger font loading\n    const allDefs: string[] = [];\n    for (const w of wrappers) {\n      const s = w.querySelector('.mermaid-source');\n      if (s) allDefs.push(s.textContent || '');\n    }\n    const cjkChars = allDefs.join('').replace(/[^\\u4e00-\\u9fff\\u3400-\\u4dbf]/g, '');\n\n    // Force browser to request the CJK font subsets by rendering chars in a hidden element\n    if (cjkChars) {\n      const probe = document.createElement('span');\n      probe.style.cssText =\n        'font-family:\"LXGW WenKai TC\",cursive;position:absolute;left:-9999px;visibility:hidden;font-size:16px';\n      probe.textContent = cjkChars;\n      document.body.appendChild(probe);\n      // Also probe Virgil for Latin\n      const probeV = document.createElement('span');\n      probeV.style.cssText =\n        'font-family:\"Virgil\",cursive;position:absolute;left:-9999px;visibility:hidden;font-size:16px';\n      probeV.textContent = 'ABCabc123';\n      document.body.appendChild(probeV);\n      // Wait for all fonts to finish loading\n      await document.fonts.ready;\n      probe.remove();\n      probeV.remove();\n    }\n\n    for (const wrapper of wrappers) {\n      const source = wrapper.querySelector('.mermaid-source');\n      const renderTarget = wrapper.querySelector('.mermaid-render');\n      const expandBtn = wrapper.querySelector('.mermaid-expand-btn');\n      const overlay = wrapper.nextElementSibling;\n\n      if (!source || !renderTarget) continue;\n\n      const def = source.textContent?.trim() || '';\n      const id = `mermaid-${Math.random().toString(36).slice(2, 9)}`;\n\n      try {\n        const { svg } = await mermaid.render(id, def);\n        renderTarget.innerHTML = svg;\n      } catch (e) {\n        renderTarget.innerHTML = `<pre style=\"color:#dc322f;font-size:0.8rem;\">Mermaid error: ${e}</pre>`;\n        continue;\n      }\n\n      // Expand button\n      if (expandBtn && overlay) {\n        const overlayContent = overlay.querySelector('.mermaid-overlay-content');\n        const closeBtn = overlay.querySelector('.mermaid-close-btn');\n\n        expandBtn.addEventListener('click', () => {\n          if (overlayContent) {\n            overlayContent.innerHTML = renderTarget.innerHTML;\n          }\n          (overlay as HTMLElement).style.display = 'flex';\n          document.body.style.overflow = 'hidden';\n        });\n\n        const closeOverlay = () => {\n          (overlay as HTMLElement).style.display = 'none';\n          document.body.style.overflow = '';\n        };\n\n        closeBtn?.addEventListener('click', closeOverlay);\n        overlay.addEventListener('click', (e) => {\n          if (e.target === overlay) closeOverlay();\n        });\n      }\n    }\n  }\n\n  // Run on page load and on Astro page transitions\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initMermaidDiagrams);\n  } else {\n    initMermaidDiagrams();\n  }\n  document.addEventListener('astro:page-load', initMermaidDiagrams);\n</script>"],"mappings":"AAyKE,eAAe,sBAAsB;AACnC,QAAM,EAAE,SAAS,QAAQ,IACvB,MAAM,OAAO,kEAAkE;AAEjF,UAAQ,WAAW;IACjB,aAAa;IACb,OAAO;IACP,MAAM;IACN,gBAAgB;MACd,cAAc;MACd,kBAAkB;MAClB,oBAAoB;MACpB,WAAW;MACX,gBAAgB;MAChB,eAAe;MACf,eAAe;MACf,cAAc;MACd,YAAY;IACd;IACA,WAAW,EAAE,YAAY,MAAM,OAAO,QAAQ;IAC9C,eAAe;EACjB,CAAC;AAED,QAAM,WAAW,SAAS,iBAAiB,kBAAkB;AAG7D,QAAM,UAAoB,CAAC;AAC3B,aAAW,KAAK,UAAU;AACxB,UAAM,IAAI,EAAE,cAAc,iBAAiB;AAC3C,QAAI,EAAG,SAAQ,KAAK,EAAE,eAAe,EAAE;EACzC;AACA,QAAM,WAAW,QAAQ,KAAK,EAAE,EAAE,QAAQ,kCAAkC,EAAE;AAG9E,MAAI,UAAU;AACZ,UAAM,QAAQ,SAAS,cAAc,MAAM;AAC3C,UAAM,MAAM,UACV;AACF,UAAM,cAAc;AACpB,aAAS,KAAK,YAAY,KAAK;AAE/B,UAAM,SAAS,SAAS,cAAc,MAAM;AAC5C,WAAO,MAAM,UACX;AACF,WAAO,cAAc;AACrB,aAAS,KAAK,YAAY,MAAM;AAEhC,UAAM,SAAS,MAAM;AACrB,UAAM,OAAO;AACb,WAAO,OAAO;EAChB;AAEA,aAAW,WAAW,UAAU;AAC9B,UAAM,SAAS,QAAQ,cAAc,iBAAiB;AACtD,UAAM,eAAe,QAAQ,cAAc,iBAAiB;AAC5D,UAAM,YAAY,QAAQ,cAAc,qBAAqB;AAC7D,UAAM,UAAU,QAAQ;AAExB,QAAI,CAAC,UAAU,CAAC,aAAc;AAE9B,UAAM,MAAM,OAAO,aAAa,KAAK,KAAK;AAC1C,UAAM,KAAK,WAAW,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,GAAG,CAAC,CAAC;AAE5D,QAAI;AACF,YAAM,EAAE,IAAI,IAAI,MAAM,QAAQ,OAAO,IAAI,GAAG;AAC5C,mBAAa,YAAY;IAC3B,SAAS,GAAG;AACV,mBAAa,YAAY,+DAA+D,CAAC;AACzF;IACF;AAGA,QAAI,aAAa,SAAS;AACxB,YAAM,iBAAiB,QAAQ,cAAc,0BAA0B;AACvE,YAAM,WAAW,QAAQ,cAAc,oBAAoB;AAE3D,gBAAU,iBAAiB,SAAS,MAAM;AACxC,YAAI,gBAAgB;AAClB,yBAAe,YAAY,aAAa;QAC1C;AACA,QAAC,QAAwB,MAAM,UAAU;AACzC,iBAAS,KAAK,MAAM,WAAW;MACjC,CAAC;AAED,YAAM,eAAe,MAAM;AACzB,QAAC,QAAwB,MAAM,UAAU;AACzC,iBAAS,KAAK,MAAM,WAAW;MACjC;AAEA,gBAAU,iBAAiB,SAAS,YAAY;AAChD,cAAQ,iBAAiB,SAAS,CAAC,MAAM;AACvC,YAAI,EAAE,WAAW,QAAS,cAAa;MACzC,CAAC;IACH;EACF;AACF;AAGA,IAAI,SAAS,eAAe,WAAW;AACrC,WAAS,iBAAiB,oBAAoB,mBAAmB;AACnE,OAAO;AACL,sBAAoB;AACtB;AACA,SAAS,iBAAiB,mBAAmB,mBAAmB;","names":[]}}