# SQAA Dashboard API

REST API serving gu-log quality metrics for the SQAA Dashboard.

Built with [Hono](https://hono.dev/) — lightweight, TypeScript-first, fast.

## Quick Start

```bash
# Install dependencies
pnpm install

# Development (hot reload)
pnpm dev

# Production
pnpm start

# Run tests
pnpm test
```

The server starts on port **3001** by default. Override with `PORT` env var.

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/api/health` | Health check + version |
| GET | `/api/metrics/overview` | All metrics summary + overall health |
| GET | `/api/metrics/security` | npm audit vulnerabilities |
| GET | `/api/metrics/eslint` | ESLint + Prettier code quality |
| GET | `/api/metrics/lighthouse` | Lighthouse performance scores |
| GET | `/api/metrics/coverage` | Test coverage percentages |
| GET | `/api/metrics/bundle` | Bundle size + budget status |
| GET | `/api/metrics/links` | Broken link analysis |
| GET | `/api/metrics/dependencies` | Dependency freshness report |
| GET | `/api/metrics/content` | Content velocity + translation delay |

### History Endpoints

Metrics with history data support these query params:

```
GET /api/metrics/security/history?from=2026-02-01&limit=10
GET /api/metrics/coverage/history?from=2026-02-01&limit=10
GET /api/metrics/bundle/history?from=2026-02-01&limit=10
GET /api/metrics/dependencies/history?from=2026-02-01&limit=10
```

| Param | Type | Description |
|-------|------|-------------|
| `from` | ISO date | Filter entries from this date onwards |
| `limit` | integer | Maximum entries to return (1-1000) |

## Response Format

### Success (metric endpoint)

```json
{
  "current": { /* latest data */ },
  "baseline": { /* first/reference data */ },
  "history": [ /* all data points */ ],
  "trend": "stable"  // "improving" | "stable" | "degrading"
}
```

### Success (overview)

```json
{
  "timestamp": "2026-02-12T18:30:00Z",
  "scores": {
    "security": { "status": "warn", "vulns": { "critical": 0, "high": 0, "moderate": 5 } },
    "codeQuality": { "status": "warn", "errors": 6, "warnings": 2 },
    "lighthouse": { "performance": 68, "accessibility": 89, "bestPractices": 96, "seo": 100 },
    "coverage": { "statements": 74.63, "branches": 42.99, "functions": 37.5, "lines": 86.62 },
    "bundle": { "totalKB": 13369.72, "withinBudget": true },
    "links": { "internal": { "ok": 27, "broken": 106 }, "external": { "ok": 347, "broken": 25 } },
    "dependencies": { "fresh": 15, "stale": 0, "outdated": 2, "deprecated": 0 },
    "content": { "total": 127, "weeklyAvg": 31.75, "avgDelayDays": 13.1 }
  },
  "overallHealth": "warning"
}
```

### Error

```json
{
  "error": "No data yet: security-audit-baseline.json",
  "code": 404
}
```

## Architecture

```
api/
├── src/
│   ├── index.ts           # Server entry point
│   ├── app.ts             # Hono app (testable)
│   ├── routes/            # One file per endpoint
│   ├── services/          # Business logic
│   ├── middleware/         # CORS, logging, error handling
│   └── types/             # TypeScript interfaces
├── tests/                 # Vitest test suite
└── vitest.config.ts
```

## Data Source

Reads JSON files from `../quality/` directory (relative to api/).
Files are generated by SQAA quality scripts (npm audit, Lighthouse, Playwright, etc.).

## Overall Health Logic

- **critical**: high/critical vulnerabilities OR deprecated dependencies
- **warning**: Lighthouse performance < 90 OR broken internal links > 0
- **healthy**: everything else
